<div class="container mt-5 p-4 bg-light rounded shadow-lg">
  <div class="row">
    <div class="col-md-8">
      <h4 class="mb-4 text-dark border-bottom pb-2 border-primary">
        Carrito de Compras
      </h4>

      <!-- Barra de b√∫squeda en la parte superior -->
      <div class="mb-3 d-flex">
        <input
          type="text"
          class="form-control form-control-lg"
          placeholder="Buscar productos por nombre o c√≥digo de barras..."
          [(ngModel)]="searchTerm"
          (keydown.enter)="buscarProductos()"
          #searchInput
        />
        <button class="btn btn-primary ms-2" (click)="buscarProductos()">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
      </div>

      <!-- Toast para notificaciones -->
      <div
        id="stockToast"
        class="toast align-items-center text-white bg-danger border-0"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
        data-bs-delay="3000"
      >
        <div class="d-flex">
          <div class="toast-body">
            Stock agotado. No se puede aumentar la cantidad.
          </div>
          <button
            type="button"
            class="btn-close btn-close-white me-2 m-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
      </div>

      <!-- Indicador de carga -->
      <div *ngIf="loading$ | async" class="text-center mb-3">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">Cargando...</span>
        </div>
      </div>

      <!-- Resultados de b√∫squeda -->
      <div *ngIf="productosEncontrados.length > 0" class="mb-3">
        <ul class="list-group">
          <li
            *ngFor="let producto of productosEncontrados"
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            {{ producto.nombre }}
            <button
              class="btn btn-primary btn-sm"
              (click)="agregarAlCarrito(producto)"
            >
              Agregar al Carrito
            </button>
          </li>
        </ul>
      </div>

      <!-- Listado de productos en el carrito -->
      <div
        *ngFor="let item of carrito"
        class="row border-bottom py-3 align-items-center"
      >
        <div class="col-4">
          <p class="mb-0 fw-bold">{{ item.nombre }}</p>
          <p class="text-success mb-0">En stock: {{ item.stockDisponible }}</p>
        </div>
        <div class="col-2">
          <p class="text-primary mb-0 fw-bold">
            {{ item.precio | currency : "CLP" }}
          </p>
        </div>
        <div class="col-4 d-flex align-items-center justify-content-end">
          <button
            class="btn btn-outline-primary rounded-circle me-2"
            (click)="disminuirCantidad(item)"
          >
            -
          </button>
          <input
            type="text"
            [(ngModel)]="item.cantidad"
            class="form-control w-25 text-center"
            readonly
          />
          <button
            class="btn btn-outline-primary rounded-circle ms-2"
            (click)="aumentarCantidad(item)"
            [disabled]="item.stockDisponible == 0"
          >
            +
          </button>
          <button class="btn ms-2 eliminar-btn" (click)="eliminarItem(item)">
            <span class="fs-4">üóëÔ∏è</span>
          </button>
        </div>
      </div>

      <!-- Total -->
      <div class="row mt-3">
        <div class="col text-end">
          <p class="fs-4 fw-bold">
            Total: {{ calcularTotal() | currency : "CLP" }}
          </p>
        </div>
      </div>
    </div>

    <!-- Secci√≥n de m√©todos de pago -->
    <div class="col-md-4 bg-white rounded shadow p-4">
      <h4 class="text-dark border-bottom pb-2 border-primary">
        M√©todo de Pago
      </h4>

      <!-- Opci√≥n de tarjeta con icono de Font Awesome -->
      <div class="form-check mb-3 d-flex align-items-center">
        <input
          class="form-check-input"
          type="radio"
          id="tarjeta"
          value="tarjeta"
          [(ngModel)]="metodoPago"
        />
        <label
          class="form-check-label ms-2 d-flex align-items-center"
          for="tarjeta"
        >
          <i class="fas fa-credit-card fs-4 me-2"></i>Tarjeta (Cr√©dito/D√©bito)
        </label>
      </div>

      <!-- Opci√≥n de efectivo con icono de Font Awesome -->
      <div class="form-check mb-3 d-flex align-items-center">
        <input
          class="form-check-input"
          type="radio"
          id="efectivo"
          value="efectivo"
          [(ngModel)]="metodoPago"
        />
        <label
          class="form-check-label ms-2 d-flex align-items-center"
          for="efectivo"
        >
          <i class="fas fa-money-bill-wave fs-4 me-2"></i>Efectivo
        </label>
      </div>

      <!-- Opciones solo si se elige tarjeta -->
      <div *ngIf="metodoPago === 'tarjeta'" class="mt-3">
        <div class="form-check mb-2 d-flex align-items-center">
          <input
            class="form-check-input"
            type="radio"
            id="tarjetaCredito"
            value="credito"
            [(ngModel)]="tipoTarjeta"
          />
          <label
            class="form-check-label ms-2 d-flex align-items-center"
            for="tarjetaCredito"
          >
            <i class="fas fa-credit-card fs-4 me-2"></i>Tarjeta de Cr√©dito
          </label>
        </div>

        <div class="form-check mb-2 d-flex align-items-center">
          <input
            class="form-check-input"
            type="radio"
            id="tarjetaDebito"
            value="debito"
            [(ngModel)]="tipoTarjeta"
          />
          <label
            class="form-check-label ms-2 d-flex align-items-center"
            for="tarjetaDebito"
          >
            <i class="fas fa-university fs-4 me-2"></i>Tarjeta de D√©bito
          </label>
        </div>

        <div *ngIf="tipoTarjeta" class="mt-3">
          <label for="pagoTarjeta">Monto a pagar con {{ tipoTarjeta }}:</label>
          <input
            type="number"
            class="form-control"
            id="pagoTarjeta"
            [(ngModel)]="montoTarjeta"
            min="0"
          />
        </div>
      </div>

      <!-- Opciones solo si se elige efectivo -->
      <div *ngIf="metodoPago === 'efectivo'" class="mt-3">
        <label for="pagoEfectivo">Ingrese con cu√°nto paga:</label>
        <input
          type="number"
          class="form-control"
          id="pagoEfectivo"
          [(ngModel)]="montoEfectivo"
          min="0"
        />
      </div>

      <!-- Bot√≥n de compra -->
      <button class="btn btn-primary btn-lg w-100 mt-4">Realizar Compra</button>
    </div>
  </div>
</div>
